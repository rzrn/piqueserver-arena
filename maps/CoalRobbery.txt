# Copyright © 2025 rzrn

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.

# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

from itertools import product
from random import Random
from math import floor

from pyspades.common import make_color
from pyspades.vxl import VXLData

name    = 'CoalRobbery'
version = '1.1'

porosity = 0.15
size, height = 24, 8

x0, y0 = 256, 256

extensions = dict(arena = True, water_damage = 100)

def gen_script(basename, seed):
    global fog

    rgen = Random(seed)

    water = fog = concrete = (0, 0, 0)

    vxl = VXLData()

    for x, y in product(range(512), range(512)):
        vxl.set_point(x, y, 63, water)

    rgba = make_color(*concrete)

    arena_spawn_list = []

    for Δx, Δy in product(range(-size, size + 1), range(-size, size + 1)):
        x, y = x0 + Δx, y0 + Δy

        if Δx % 2 == 0 and Δy % 2 == 0:
            vxl.set_column_fast(x, y, 61 - height, 63, 63, rgba)
        elif porosity < rgen.uniform(0, 1):
            vxl.set_point(x, y, 62, concrete)
            arena_spawn_list.append((x, y, 62))

        if Δx % 2 == 0:
            vxl.set_point(x, y, 61 - (height + 1), concrete)

    extensions['arena_blue_spawns'] = extensions['arena_green_spawns'] = arena_spawn_list

    return vxl
